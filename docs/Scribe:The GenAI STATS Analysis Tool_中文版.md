# Scribe：GenAI STATS 分析工具


## 概述

風險資訊技術（Risk IT）部門的各種系統以產生多模態數據集而聞名，   
這些數據集需要進行專門分析以評估發生了什麼變化以及變化是否有效。   

例如，為了識別程式碼變更是否對最終報告產生影響，   
我們需要收集程式碼庫、   
追溯至任何人工調整的系統輸入文件，   
以及用於生成這些輸入文件指標的任何模型變更。  

這項工作旨在探索是否可以通過自動化方式將這些數據導入知識圖譜，    
以便我們能夠互動式地查詢可能導致報告變化的程式碼和數據變更。  

總體方法是將所有數據導入知識圖譜，以增加上下文並減少 AI 幻覺。   
從這個統一平台，我們可以為機器學習模型建立自動化輸入，   
並在數據之上運行 GenAI 聊天機器人，   
使用戶能夠輕鬆存取知識圖譜或現有平台中的上下文數據。

「自動化分析，提升品質。」


## SCRIBE (STATS) 邏輯架構

![img_3.png](img_3.png)

- Scribe 是 STAS 中用於執行影響分析和差異分析的模組。

- 建議使用 IA/VA 平台時，同時接入協調和分析功能。

- STAS 將成為執行和分析影響/差異分析的集中平台。

- 我們的服務將建立在 STAS 架構和基礎設施之內。

- 新的 Scribe 服務將是可移除且獨立的，但會進行優化以吸引用戶接入 STAS。


## 功能特性

![img_4.png](img_4.png)

功能表內容如下：

- 工作流程協調
  提供影響分析（IA）和差異分析（VA）請求的集中追蹤、視覺化和控制，實現跨組織團隊和部門的流程化管理和監督。
  狀態：已完成

- 可擴展數據導入
  支援安全上傳和導入多種數據集，以進行全面分析和細粒度鑽取。數據持久化目前通過企業網路附加儲存（NAS）和 Amazon S3 管理，確保高可用性和可擴展性。
  狀態：整合中

- 自動化差異分析
  支援對上傳數據集進行複雜的差異分析和比較，識別各迭代版本之間的差異和變化。與 FAST 平台的無縫整合提升了比較評估的效率和準確性。
  狀態：整合中

- 程式碼圖譜智能
  利用專有知識圖譜精確識別特定程式碼修改與觀察到的輸出報告變化之間的因果關係，在程式碼層面提供細粒度的影響分析。
  狀態：整合中

- 機器學習圖譜優化引擎
  運用針對不同用例和數據領域定制的專業機器學習模型，自動識別並歸因影響輸出報告的變化。此功能包括強大的 MLOps 平台整合，用於模型生命週期管理和持續優化。
  狀態：整合中

- VIPER 元數據整合與洞察
  利用 VIPER 元數據動態生成數據子圖和概念形態，促進進階分析鑽取。這些結構化數據表示經過優化，可供大型語言模型（LLM）聊天機器人代理查詢，增強互動式數據探索並消除幻覺。
  狀態：整合中

- 可配置動態用戶介面
  通過基於 JSON 的配置，支援創建 API 驅動的網頁應用程式和高度動態的數據視覺化。這使得能夠快速開發用戶驅動的儀表板、臨時差異列視圖和其他互動式分析工具。
  狀態：開發中

- 基於生成式 AI 的影響與差異分析
  採用先進的生成式 AI 功能產生全面的報告和分析概述。這包括詳細洞察輸入數據、原始碼或服務配置的變更如何傳播並影響輸出文件的變化，提供主動式影響智能。
  狀態：開發中


## 技術組件

![img_5.png](img_5.png)

組件表內容如下：

- Neo4j 圖形資料庫
  一個高度可擴展且高效能的原生圖形資料庫，專為儲存、查詢和分析高度互連的數據而優化。  
  它作為知識圖譜的基礎數據儲存，支援程式碼組件、輸出報告和 VIPER 元數據之間的複雜關係，實現高效遍歷以進行影響和差異分析。

- FastAPI 與 Pydantic
  FastAPI 是一個現代、高效能的網頁框架，用於使用 Python 建立強大且可擴展的 API，充分利用非同步程式設計能力。   
  Pydantic 用於數據驗證、序列化和設定管理，確保數據完整性和開發效率；兩者共同構成平台 API 層的骨幹，促進與動態 UI、機器學習服務和其他整合系統的無縫數據交換。

- CitiRisk 動態 UI
  一個內部框架或工具集，可能基於宣告式 JSON 配置，旨在快速構建和渲染動態網頁介面。   
  此組件支援創建可適應的儀表板、可配置的數據視覺化和互動式分析工具，符合平台對用戶驅動、API 驅動前端體驗的需求，無需大量前端程式碼部署。

- MongoDB
  一個靈活的 NoSQL 文件資料庫，為非結構化和半結構化數據提供高可用性、可擴展性和效能。   
  適合儲存多種數據類型，如原始上傳文件、動態 UI 的配置元數據、操作日誌，以及可能不嚴格符合關係型或圖形架構的中間處理結果，補充 Neo4j 中的結構化數據。

- 機器學習圖譜技術棧
  底層機器學習框架（如 TensorFlow、PyTorch、Scikit-learn、MLflow），負責開發、訓練、部署和管理專業機器學習模型的生命週期。   
  此框架將為「機器學習驅動優化引擎」提供必要的工具和基礎設施，使平台能夠通過先進的統計和預測分析自動識別關鍵變化並預測其對輸出報告的影響。

- Code Scribe 技術棧
  一個專門的工具或服務，旨在與圖形資料庫（如 Neo4j）互動，從複雜的圖形數據中提取、轉換和生成結構化洞察或文件。    
  它可能促進從知識圖譜和 VIPER 元數據程式化生成報告、摘要或視覺表示，通過將複雜的圖形結構轉化為可操作的智能，   
  增強「知識圖譜驅動程式碼分析」和「VIPER 元數據整合與洞察生成」功能。

## 功能描述 [v0.2 VIPER 元數據整合與洞察]

![img_6.png](img_6.png)

API 功能表內容如下：

- 無縫領域數據整合（DEV/UAT/PRD）
  提供從任何環境（DEV、UAT、PRD）按需存取領域特定數據。此組件無縫地將指定數據導入集中式知識圖譜，為整個開發生命週期中的 API 驅動分析和洞察創建統一基礎。

- 類別/物件模型 API 存取（DDD）
  利用 Pydantic 強大的數據驗證功能，從 VIPER 元數據自動生成領域特定物件模型。這確保了數據完整性，並為開發人員提供類型安全、即用型的 Python 類別，用於通過高效能 FastAPI 介面與 DEV、UAT 和 PRD 數據互動。

- 領域差異分析
  通過隨時間導入來自多個 VIPER 領域的數據，實現強大的時間序列分析。通過在知識圖譜內創建明確的關係，此 API 支援高效遍歷和識別數據差異，輕鬆追蹤數據集在不同時間點或版本之間的變化。

- Gemini 影響/差異分析
  利用知識圖譜的上下文能力，提供 AI 驅動的影響和差異分析。通過與底層程式碼儲存庫和數據集整合，此組件可在數分鐘內執行大規模自動化 UAT，將程式碼變更與其對數據輸出和系統行為的精確影響相關聯。

- 數據血緣調和
  通過將實際生產數據與權威的 VIPER 元數據目錄進行比較，提供強大的數據驗證。此功能自動執行數據架構、標題和規格的調和，確保生產數據符合其預期設計，並標記任何差異以供審查。

## 邏輯架構 [v0.2 VIPER 元數據整合與洞察]

![img_7.png](img_7.png)

- 用戶可以選擇一個領域，獲取所有可用的 COB 或可用數據的日期，然後載入到圖形中（適用於所有可用連接器）。

- VIPER 數據整合將從遠端位置獲取文件/表格等，並根據 VIPER 領域模型（SFTP）自動載入到圖形中。

- 一旦我們創建 VIPER 映射和基礎設施連接，VIPER 數據整合將自動從 Postgres、文件和所有其他數據源類型中檢索數據。

- 這些數據將儲存在跨多個伺服器和區域的 Neo4j 無限圖形中。

- 用戶/應用程式/平台可以查詢要載入/可用的數據，並從 VIPER API 請求通用分析，如差異分析。

- 最終一切都將升級到 Redis，我們尚未完成效能調優。

## 架構 [v0.2 VIPER 元數據整合與洞察]

![img_8.png](img_8.png)

建議所需的基礎設施：

- 微服務基礎設施（如 ECS）
- NAS 文件儲存（如 S3）
- UI 基礎設施（如 CloudFront）
- Neo4j InfiniGraph 授權
- 密鑰管理器

- 展示近期伺服器和精確架構圖…部署圖

## 使用的 API

功能 / API / 用例 內容如下：

調和服務：
- 數據獲取 / 數據標題與 VIPER 元素對比
- API：`POST /api/v1/knowledgegraph/analysis/{workflow_id}/data_lineage_header_reconciliation`
- 用例：請告訴我 Olympus 和 VIPER 定義之間的標題差異是什麼？

數據導入：
- 文件導入 / Neo4j VIPER 圖形結構創建 / 重複數據導入檢查
- API：`POST /api/v1/data_import/import`

差異分析：
- 領域類型選擇
- 領域名稱選擇
- 週期選擇
- 聚合級別選擇
- CAGID 選擇
- GFCID 選擇
- NettingID 選擇
- 指標選擇
- 分析執行

部分主要 API：
- `POST /api/v1/variance-analysis/workflows/{workflow_id}/analyze`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/domain-types`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/domain-types/{domain_type}/domains`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/domains/{domain_type}/{domain_name}/periods`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/aggregation-levels`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/domains/{domain_name}/cagids`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/domains/{domain_type}/{domain_name}/cagids/{cagids}/gfcids`
- `GET /api/v1/variance-analysis/workflows/{workflow_id}/domains/{domain_name}/metrics`

示例用例：
- 請告訴我哪些壓力測試情境從七月月末到八月月末有超過 10% 的差異。
- 請按 CAGID、GFCID、Netting ID 聚合顯示美元下跌情境的壓力數據差異。
- 現在顯示摩根大通的交易數據。

## Synapse 影響分析架構

![img_9.png](img_9.png)

- 第一步是創建工作流程。
- 第二步是上傳盡可能多或適用於您分析工作流程的數據集。
- 所有數據上傳後，可以發起分析請求。
- 分析請求是非同步的，可能需要一些時間才能完成。

- Synapse 工作流程服務用於查詢工作流程的 CRUD 操作。
- Synapse 數據服務用於上傳和/或連接數據源到工作流程，以進行導入和分析。
- Synapse 分析是查詢狀態、報告和影響/差異分析處理的方式。


## Synapse 影響分析客戶端分析前序列圖

![img_10.png](img_10.png)

![img_11.png](img_11.png)

## 概念驗證 1：VIPER 驅動的 GenAI 分析

![img_12.png](img_12.png)

- 在概念驗證中，我們依賴 VIPER 中的領域資訊。
- 首先，我們將傳入輸入/輸出文件和程式碼的領域資訊。
- 其次，我們將使用領域資訊來檢索程式碼庫以及輸入和輸出文件。

- GenAI 將用於關聯程式碼和輸入文件中的哪些差異導致了輸出文件的變化。
- 如果 VIPER 中有可用的修正資訊，還將進行驗證，這將提高元數據的精確度和準確性。
- 迭代過程將為 VIPER 和 GenAI 影響分析工作帶來精確性。

## 概念驗證 2：Synapse 知識圖譜架構

![img_13.png](img_13.png)

- 開發人員輔助程式碼生成
- 通用工具
- SecDB 模式

- Synapse Create 將幫助開發人員創建將二維數據源映射到 Neo4j 所需的核心程式碼。
- 然後開發人員將開始編碼，並根據需要對自動生成的程式碼進行修改。


## 執行與分析 [2025/5/6]

目前我們正在研究的 IA 應用程式不僅處理結果，還處理程式碼的執行和結果的生成。此外，我們還沒有找到任何能夠自動執行影響分析的平台。下面展示了 GenAI IA 平台的兩個架構選項：


![img_14.png](img_14.png)
