# Scribe 差異分析功能說明

## 概述

差異分析（Variance Analysis）是 Scribe 平台的核心功能之一，用於自動化比較不同時間點或版本的數據，識別變化並提供深度洞察。

「自動化分析，提升品質。」

---

## 核心功能

### 1. 數據變化識別

比較兩個時間點的數據（如 20251106 vs 20251107），自動識別：

| 識別類型 | 說明 |
|----------|------|
| **數值變化** | 哪些指標數值增減了？變化幅度多少？ |
| **新增/刪除記錄** | 哪些交易是新增的？哪些被移除？ |
| **欄位變更** | 哪些欄位的值被修改了？ |

### 2. 聚合層級分析

可按不同維度進行聚合比較：

```
├── 按 CAGID（客戶群組）
├── 按 GFCID（全球客戶ID）
├── 按 Netting ID（淨額結算組）
├── 按 產品類型（IRS, CDS, FX等）
├── 按 區域（NAM, EMEA, APAC, LATAM）
└── 按 壓力情境（BASE, ADVERSE, SEVERE等）
```

### 3. 閾值異常偵測

自動標記超過設定閾值的變化項目，例如：
- 變化幅度 > 10%
- 絕對值變化 > $1,000,000
- 信用評級下降

---

## 實際應用場景

| 場景 | 說明 |
|------|------|
| **月末報告比對** | 比較 7月月末 vs 8月月末的壓力測試結果 |
| **UAT 驗證** | 驗證新版本程式碼產出的結果是否符合預期 |
| **監管報告審核** | 確認提交給監管機構的數據變化是否合理 |
| **異常偵測** | 找出變化超過閾值的異常項目 |
| **數據血緣追蹤** | 追溯數據變化的來源與影響範圍 |

---

## 範例查詢

透過 Scribe API 或 GenAI 聊天介面，可進行以下查詢：

```
"哪些壓力測試情境從七月到八月有超過 10% 的差異？"

"顯示 JP Morgan Chase 的曝險金額變化"

"按 CAGID 聚合，哪些客戶的信用評級下降了？"

"請按 CAGID、GFCID、Netting ID 聚合顯示美元下跌情境的壓力數據差異"
```

---

## 與 GenAI 結合的進階分析

### 分析流程

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   數據差異      │ ──▶ │   知識圖譜      │ ──▶ │   GenAI 分析    │
│  (What changed) │     │  (關聯程式碼)   │     │  (Why changed)  │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### GenAI 能回答的問題

- 這個數據變化是由哪段程式碼修改造成的？
- 輸入檔案的哪些欄位變更導致了輸出結果的差異？
- 這個變化是預期內的還是潛在問題？
- 哪些上游系統的變更可能影響了這份報告？

---

## 差異分析流程示意

以信用風險交易數據為例：

```
olympus_credit_txn_20251106.dat  ──┐
                                   ├──▶  差異分析引擎  ──▶  分析報告
olympus_credit_txn_20251107.dat  ──┘
```

### 分析報告內容

```
差異分析報告
============
比較期間：2025-11-06 vs 2025-11-07
總交易筆數：100 筆

摘要：
- 數值變化筆數：N 筆
- 曝險總額變化：$X → $Y（變化 Z%）
- 新增交易：M 筆
- 移除交易：K 筆

按交易對手分組變化：
┌──────────────────┬────────────┬────────────┬──────────┐
│ 交易對手         │ 前期曝險   │ 本期曝險   │ 變化率   │
├──────────────────┼────────────┼────────────┼──────────┤
│ JP Morgan Chase  │ $1,500,000 │ $1,650,000 │ +10.0%   │
│ Goldman Sachs    │ $875,000   │ $820,000   │ -6.3%    │
│ ...              │ ...        │ ...        │ ...      │
└──────────────────┴────────────┴────────────┴──────────┘

異常項目（變化 > 10%）：
- TXN000023: 曝險金額變化 +15.2%
- TXN000047: 信用評級從 A 降至 BBB+
- TXN000089: 新增交易，曝險 $2,100,000
```

---

## 相關 API

### 差異分析主要 API

| API | 說明 |
|-----|------|
| `POST /api/v1/variance-analysis/workflows/{workflow_id}/analyze` | 執行差異分析 |
| `GET /api/v1/variance-analysis/workflows/{workflow_id}/domain-types` | 取得領域類型 |
| `GET /api/v1/variance-analysis/workflows/{workflow_id}/domains/{domain_type}/{domain_name}/periods` | 取得可用期間 |
| `GET /api/v1/variance-analysis/workflows/{workflow_id}/aggregation-levels` | 取得聚合層級 |
| `GET /api/v1/variance-analysis/workflows/{workflow_id}/domains/{domain_name}/metrics` | 取得可用指標 |

### 數據調和 API

| API | 說明 |
|-----|------|
| `POST /api/v1/knowledgegraph/analysis/{workflow_id}/data_lineage_header_reconciliation` | 數據標題與 VIPER 定義比對 |
| `POST /api/v1/data_import/import` | 數據導入 |

---

## 平台價值

| 價值面向 | 傳統方式 | Scribe 平台 |
|----------|----------|-------------|
| **分析時間** | 數小時至數天 | 數分鐘 |
| **人力需求** | 多位分析師 | 自動化處理 |
| **錯誤率** | 人工比對易出錯 | 系統化精確比對 |
| **追溯能力** | 難以追蹤根因 | 知識圖譜關聯分析 |
| **報告品質** | 格式不一 | 標準化報告 |

---

## 參考資料

- [Scribe: The GenAI STATS Analysis Tool](Scribe:The%20GenAI%20STATS%20Analysis%20Tool.md)
- [Scribe 中文版說明](Scribe:The%20GenAI%20STATS%20Analysis%20Tool_中文版.md)
